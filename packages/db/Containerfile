# Containerfile
FROM python:3.12-slim

# Install deps
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    libpq-dev \
    postgresql-client \
    bash \
    && rm -rf /var/lib/apt/lists/*

# Copy db package
WORKDIR /app
COPY packages/db /app/packages/db

# Copy sample data files
COPY data/ /app/data/

# Install uv + deps
RUN pip install uv
RUN uv venv /app/venv
ENV PATH="/app/venv/bin:$PATH"
RUN uv pip install -e ./packages/db

# Copy and setup startup script
COPY packages/db/startup.sh /app/startup.sh
RUN chmod +x /app/startup.sh

# Run startup script which handles migrations and data loading
CMD ["/app/startup.sh"]
